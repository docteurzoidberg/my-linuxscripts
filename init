#!/bin/bash

# TODO !
# pour chaque script dans init-enabled/ lancer le script avec les parametres LSB standards si disponibles


#------------------------------------------------------------------------
#------------------------------------------------------------------------
#------------------------------------------------------------------------


ROOT_PATH='/root/scripts'
SCRIPTS_PATH='/root/scripts/init.d'
SCRIPTS_ENABLED='init-enabled'
VERSION=0.1

cd $ROOT_PATH

. ./config
. ./functions

encadre "INIT SCRIPT V$VERSION"


function list_enabled_scripts {

	jaune "Scripts actifs: "

	for script in ${SCRIPTS_PATH}/${SCRIPTS_ENABLED}/*; do
        	rouge "(*) ${script}" | sed -e "s,${SCRIPTS_PATH}/${SCRIPTS_ENABLED}/,,g"
	done;
}



#------------------------------------------------------------------------
#------------------------------------------------------------------------
#------------------------------------------------------------------------


function start_scripts {

	jaune "Lancement des scripts..."

	for script in ${SCRIPTS_PATH}/${SCRIPTS_ENABLED}/*; do
        	rouge "-> ${script}" | sed -e "s,${SCRIPTS_PATH}/${SCRIPTS_ENABLED}/,,g"
        	chmod +x ${script}
        	commande "${script} start"
	done;
}


function stop_scripts {
	jaune "ArrÃªt des services..."

	for script in ${SCRIPTS_PATH}/${SCRIPTS_ENABLED}/*; do
                rouge "-> ${script}" | sed -e "s,${SCRIPTS_PATH}/${SCRIPTS_ENABLED}/,,g"
                chmod +x ${script}
                commande "${script} stop"
        done;
}

function command_script {
	case $2 in
	"enable")
		echo "todo: enable script"
        	;;
	"disable")
		echo "todo: disable script"
        	;;
	*)
		if [[ ! -z $2 ]]
		then
			rouge "Commande inconnue: $2"
		fi
        	jaune "Utilisation: "
        	echo "init {scriptname} enable"
        	echo "init {scriptname} disable"
        	echo "init start"
        	echo "init stop"
        	;;
	esac

}

case $1 in
"start")
	start_scripts
	;;
"stop")
	stop_scripts
	;;
*)
	if [[ ! -z $1 ]]
	then
		rouge "Commande inconnue: $1"
		echo "usage:"
	fi
	command_script $1 $2
	;;
esac



